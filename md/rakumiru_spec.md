# ラクミル（Rakumiru） 仕様・目的まとめ（Draft）

## 1. アプリ概要
**ラクミル**は、楽天市場APIで「売れ筋商品」をリサーチし、Gemini APIで商品説明文を自動生成して、**楽天ROOMへの投稿を補助**するWebアプリです。  
ユーザーは非エンジニア（IT知識ほぼゼロ）を想定し、**最小ステップで使えるUI**を重視します。

---

## 2. 目的（Why）
- 楽天ROOM投稿の「ネタ探し（売れ筋リサーチ）」を自動化し、投稿の手間を減らす
- 投稿文（商品説明・推しポイント）作成をAIで補助し、品質と投稿速度を上げる
- ユーザーが「投稿に使える素材」をアプリ内に蓄積し、再利用できるようにする

---

## 3. 想定ユーザー
- 楽天ROOMで投稿したいが、リサーチや文章作成が苦手な人
- IT知識がほぼない（APIキーや設定画面も最小限が良い）
- 将来的にはLINEログインを使って複数ユーザー運用する想定

---

## 4. 技術スタック / 実行環境
- サーバ：スターサーバー（PHP実行環境）
- 言語：PHP（バックエンド） / JavaScript（フロント） / HTML / CSS
- DB：MySQL
- 外部API：
  - 楽天市場API（ランキング/商品情報取得）
  - Gemini API（商品説明生成：generateContent）

---

## 5. 画面（ページ）構成（現状案）
### 5.1 ダッシュボード（index.php）
- 現時点では仮表示（「未定」などのプレースホルダ）
- いずれ以下を表示候補：
  - 本日の取得件数、生成件数、保存件数
  - 直近の取得商品/生成結果へのショートカット
  - エラー履歴（APIエラー・保存失敗）

### 5.2 API設定（api_settings.php）
**非エンジニア向けに項目は最小限：**
- 楽天アプリID（applicationId）
- Gemini API Key
- 「テストして保存」ボタン（テストOKならDBに保存）

表示：
- 「保存済 / 未保存」「最終更新日時」など、安心できるステータス表示

> 注：ブラウザの自動補完により、勝手にメール/パスワードが入ることがあるため、`autocomplete`対策を行う。

### 5.3 取得商品一覧（items.php など）
- DBに保存された売れ筋商品を一覧表示
- 並び替え：ランキング順 / 新着順
- 検索：キーワード、カテゴリ
- 商品詳細（モーダル or 詳細ページ）
  - 商品名、価格、画像、URL、ショップ名、ポイント等
  - Gemini生成文（複数候補）
  - 「コピー」ボタン（ROOM投稿用）

---

## 6. UI/デザイン方針
- 楽天っぽい配色：**白/グレー基調 + 赤系アクセント**
- モダン/ミニマル（カードUI、角丸、影は控えめ）
- ヘッダーにハンバーガーメニュー
  - 押すと画面外からスライドメニュー表示
  - メニュー項目：**API設定 / 商品一覧**（当面は2つ）

---

## 7. ファイル構造（現状方針）
```
/rakumiru
  index.php
  api_settings.php
  items.php（予定）

  /inc
    config.php
    db.php
    functions.php

  /api
    test_save_keys.php
    _response.php
    （今後：fetch_items.php, generate_text.php 等）

  /js
    app.js

  /css
    style.css

  header.php
  footer.php

  /icon
    icon.png
```

---

## 8. データ設計（現状想定）
ユーザーごとに保存していく前提。

### 8.1 users（予定）
- `id`
- `line_user_id`（将来：LINEログイン用）
- `created_at`, `updated_at`

※ 現状は仮で `user_id = 1` 固定運用。

### 8.2 api_keys（作成済み）
目的：ユーザーごとのAPIキー/設定値を保存

想定カラム（例）：
- `id` (PK)
- `user_id`
- `provider`（例：`gemini`, `rakuten_app_id`）
- `value`（APIキー/IDの値）
- `key_hint`（末尾4桁など、マスク表示用）
- `created_at`, `updated_at`

運用：
- API設定画面で入力→テスト→OKなら保存
- 画面には **全文キーを表示しない**（hint と更新日時のみ）

### 8.3 items（予定：商品テーブル）
目的：楽天市場から取得した売れ筋商品を保存

例カラム：
- `id` (PK)
- `user_id`
- `rakuten_item_code`（ユニークキー候補）
- `item_name`
- `item_url`
- `image_url`
- `price`
- `shop_name`
- `rank`（ランキング順位）
- `genre_id`（カテゴリ/ジャンル）
- `captured_at`（取得日時）
- `created_at`, `updated_at`

### 8.4 generated_texts（予定：生成文テーブル）
目的：商品ごとのGemini生成結果を蓄積し再利用

例カラム：
- `id` (PK)
- `user_id`
- `item_id`（itemsへのFK）
- `model`（例：`models/gemini-2.5-flash-lite`）
- `prompt`
- `output_text`
- `created_at`

---

## 9. 主要機能（MVP）
### 9.1 API設定
- 楽天AppID + Gemini API Key を入力
- 「テストして保存」
  - 楽天：ランキングAPIで疎通確認
  - Gemini：generateContentで疎通確認（モデルは通る候補を探索して選択）
- 成功したらDB保存し、画面にステータス表示

### 9.2 売れ筋取得 → DB保存
- 楽天ランキングAPIで売れ筋商品を取得
- 必要な項目のみ抽出し `items` に保存
- 更新ポリシー例：
  - 同じ `rakuten_item_code` は upsert（最新情報に更新）
  - rank / price / captured_at を更新

### 9.3 商品説明文の生成（投稿補助）
- 選択商品に対してGeminiで説明文を生成
- ROOM投稿に使いやすい形式（短文/長文/箇条書き/絵文字あり等）
- 生成結果を保存し再利用可能にする

---

## 10. 外部API仕様（ざっくり）
### 10.1 楽天市場API（例）
- 目的：売れ筋ランキング取得
- エンドポイント例：IchibaItem/Ranking
- 取得項目例：商品名、URL、画像、価格、ショップ名、順位

### 10.2 Gemini API（例）
- 目的：商品説明文生成
- generateContent を使用
- モデルは実行環境で通るものを自動選択（例：`models/gemini-2.5-flash-lite`）

---

## 11. セキュリティ / 運用注意
- APIキーはDB保存（画面に全文を出さない）
- リポジトリに秘密情報をコミットしない（`.env`化が理想）
- 将来的に：
  - APIキーは暗号化保存（at-rest）
  - LINEログイン導入（user_id固定を廃止）
- 429（クォータ）対策：
  - 生成テストは回数を抑える
  - 生成に成功したモデルを保存して使い回す

---

## 12. 今後のロードマップ（案）
1. API設定ページ（保存・疎通確認）を安定化
2. 売れ筋ランキング取得 → `items` 保存（定期実行も検討）
3. 商品一覧ページ（検索・詳細・コピー）
4. Gemini生成（テンプレ/複数パターン・保存）
5. LINEログイン導入（ユーザー管理）
6. 楽天ROOM投稿の“補助”強化（コピーボタン、投稿テンプレ、チェックリスト等）

---

## 13. 決めたこと（現時点）
- アプリ名：ラクミル
- 技術：PHP（スターサーバー）＋MySQL
- 画面：API設定 / 商品一覧 / ダッシュボード（仮）
- ヘッダー：ハンバーガーメニュー + スライドメニュー
- デザイン：白/グレー基調 + 赤アクセント、モダン/ミニマル
- まずログイン無し（user_id=1固定）→ 将来LINEログイン
